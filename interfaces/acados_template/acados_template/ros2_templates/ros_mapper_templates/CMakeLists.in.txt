cmake_minimum_required(VERSION 3.16)
project({{ package_name }})
if(CMAKE_VERSION VERSION_GREATER_EQUAL 3.27)
    cmake_policy(SET CMP0148 OLD)
endif()

# --- ROS DEPENDENCIES ---
find_package(ament_cmake REQUIRED)
find_package(rclcpp REQUIRED)
{%- for dep in dependencies %}
find_package({{ dep }} REQUIRED)
{%- endfor %}

# --- EXECUTABLE ---
add_executable({{ node_name }}
    src/node.cpp
)

# --- TARGET CONFIGURATION ---
if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES "Clang")
    target_compile_options({{ node_name }} PRIVATE -Wall -Wextra -Wpedantic)
endif()

target_include_directories({{ node_name }} PUBLIC
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
    $<INSTALL_INTERFACE:include>
)

# --- DEPENDENCIES ---
ament_target_dependencies({{ node_name }}
    rclcpp
    {%- for dep in dependencies %}
    {{ dep }}
    {%- endfor %}
)

# --- INSTALLATIONS ---
install(TARGETS
    {{ node_name }}
    RUNTIME DESTINATION lib/${PROJECT_NAME}
)

install(DIRECTORY
    include/
    DESTINATION include
)

# --- TESTS ---
if(BUILD_TESTING)
    find_package(launch_testing_ament_cmake REQUIRED)
    add_launch_test(
        test/test_{{ package_name }}.launch.py
        TARGET test_{{ package_name }}
        TIMEOUT 180
    )
endif()

ament_package()